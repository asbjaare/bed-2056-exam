---
title: "Bed-2056 Exam"
author: "Asbjorn Aarekol & Morten Ostrem"
date: "12/7/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```

# Weapons and related data worldwide
Initialy we wanted to look at if firearms ownership was related to any other usual measuring metrics for countries like GDP, life expetancy etc...

```{r create data, include=FALSE}
rm(list=ls())

# load packages
library(tidyverse)
library(rvest)
library(readxl)

# Read the happines data from the UN from the CSV and put it in a dataframe
# Using the data from 2017 as the wikipedia data is also from 2017
# Data gotten from kaggle
df2017 <- read_csv('2017.csv')

# Create a dataframe for all homicide worldwide and remove the source collums
# Remove the subregion rows aswell
# Data gotten from dataUNODC
homicide_df <- read_excel('homicide_all.xls') %>% 
  subset(., select = c(1:7)) %>% 
  filter(., Indicator == 'Firearms rate')

# Find the table from wikipedia and return a dataframe
table <- "https://en.wikipedia.org/wiki/Estimated_number_of_civilian_guns_per_capita_by_country" %>%
  read_html() %>%
  html_nodes(xpath='//table[1]') %>% 
  html_table(header = TRUE, fill = TRUE) %>% 
  .[[1]] %>% 
  data.frame()


# Rename the variables in the wikipedia table df and merge it with the happines data
df <- table %>% 
  rename("Country" = Country..or.dependent.territory..subnational.area..etc..) %>% 
  merge(., df2017) %>% 
  rename("Happiness_score" = Happiness.Score) %>% 
  rename("GDP_percap" = Economy..GDP.per.Capita.) %>% 
  mutate("Firearms_per100" = Estimate.of.civilian.firearms.per.100.persons) %>% 
  mutate("Life_expe" = Health..Life.Expectancy.) %>% 
  mutate("Firearms_estimate" = as.numeric(gsub(",", "", Estimate.of.firearms.in.civilian.possession))) %>% 
  mutate(Population = as.numeric(gsub(",", "", Population.2017, fixed = FALSE))) %>% 
  select(Country, Firearms_per100, Firearms_estimate, Population, Region, Happiness_score, GDP_percap, Life_expe) 


```

## Plot of firearms per 100 inhabitant
This plot shows the ammount of firearms per 100 inhabitants in each country.


```{r 100fire , echo=FALSE}
# TODO: Make it only top 25 or something and plot the civilian gun ownership vs the military one. 85% of firearms worldwide is owned by civilians

# Plot the countries sorted in a barplot
ggplot(filter(df, Firearms_per100 > 18.6), aes(reorder(Country, Firearms_per100), Firearms_per100, fill = Region)) +
  geom_bar(stat = "identity", show.legend = TRUE) +
  geom_text(aes(label = Firearms_per100), vjust = 1, hjust = 1, size = 3) +
  ylab('Firearms per 100 inhabitants') +
  ggtitle('Top 25 countries in the world ranked by firearms per 100 inhabitants') +
  theme_minimal() +
  theme(axis.title.y = element_blank()) +
  coord_flip()
```

## Plot of firearms per 100 inhabitants vs happines score from the World happines report
This plot is not very conclusive in any relation between the happines and ammount of firearms per 100 inhabitants

```{r fire100 vs happines, echo=FALSE}

# Plot the firearms100 vs happines
ggplot(filter(df, Firearms_per100 > 18.6), aes(Happiness_score, Firearms_per100, color = Region, size = Population)) +
  geom_jitter(aes(), show.legend = TRUE) +
  geom_text(aes(label=ifelse(Firearms_per100>34,as.character(Country),'')), hjust=0,vjust=1, size = 4, angle = 50, show.legend = FALSE)


```

## Plot of GDP vs firearms 
Same as above, not much interresting to read from the data

```{r fire100 vs GDP, echo=FALSE}

# Plot the firearms100 vs GDP
ggplot(filter(df, Firearms_per100 > 18.6), aes(GDP_percap, Firearms_per100, color = Region, size = Population)) +
  geom_jitter(aes(), show.legend = TRUE) +
  geom_text(aes(label=ifelse(Firearms_per100>34,as.character(Country),'')), hjust=0,vjust=1, size = 4, angle = 50, show.legend = FALSE)

```

## Life expectancy vs firearms
Same story as before

```{r fire100 vs Life expectany, echo=FALSE}

# Plot the firearms100 vs life expectancy
ggplot(filter(df, Firearms_per100 > 18.6), aes(Life_expe, Firearms_per100, color = Region, size = Population)) +
  geom_jitter(aes(), show.legend = TRUE)+
  geom_text(aes(label=ifelse(Firearms_per100>34,as.character(Country),'')), hjust=0,vjust=1, size = 4, angle = 50, show.legend = FALSE)

# TODO: Plot vs freedom value aswell

```


Given these results it shows that the answer to what affects gun ownership does not corelate to any of the metrics from the happines report. 


# A Change in outlook
Given that the data did not show anything else other than that there might not be a relation between these metrics, we want to change our outlook and look at homicide by firearms.



## Homicide globaly by subregions from 2000 to 2015

```{r homicide over the years by subregion, echo=FALSE}
# TODO: Mabye split into low, medium and high. Then mabye see at if there is any data from these regions that explain what causes these differences.
ggplot(homicide_df, aes(Year, Value, group = Subregion, fill = Subregion)) +
  geom_bar(stat = 'identity', show.legend = FALSE) +
  facet_wrap(~Subregion) +
  theme_light() +
  theme(axis.text.y.left = element_blank())

```

## Firearms homicide vs firearms per 100 inhabitants
This shows that the Americas region has higher firearms per 100 inhabitants, but there does not seem to be a correlation between the firarms avaliable to people and the firearms homicide rate

```{r Firearms homicide vs firearms100, echo=FALSE}

df_2 <- table %>% 
  rename("Country" = Country..or.dependent.territory..subnational.area..etc..) %>% 
  rename("Firearms100" = Estimate.of.civilian.firearms.per.100.persons) %>% 
  rename("Firearms_estimate" = Estimate.of.firearms.in.civilian.possession) %>% 
  rename("Reg_firearm" = Registered.firearms) %>% 
  rename("Unreg_firearm" = Unregistered.firearms) %>% 
  rename("Population" = Population.2017) %>% 
  mutate(Population = sub(",", "", Population, fixed = FALSE)) %>%
  mutate(Population = sub(",", "", Population, fixed = FALSE)) %>% 
  mutate(Population = as.numeric(Population)) %>% 
  select(Country, Firearms100, Population, Region)

# Create the 
df_fire_vs_homi <- homicide_df %>% 
  filter(., Level == "Country") %>% 
  filter(., Year == 2012) %>% 
  select(Territory, Value) %>% 
  mutate(Value = as.numeric(Value)) %>% 
  rename('Country' = Territory) %>% 
  merge(., df_2)


# Plot the firearms100 vs happines
ggplot(df_fire_vs_homi, aes(Firearms100, Value, color = Region, size = Population)) +
  geom_jitter(aes(), show.legend = TRUE) +
  xlab("Homicide rate by firearms") +
  ylab("Firearms per 100 inhabitants") +
  theme(axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        axis.text.y.left = element_blank(),
        axis.text.x = element_blank())

```
